<!-- To the extent possible under law, the person who associated CC0 with this work has waived all copyright and related or neighboring rights to this work.-->
<h1>Geometry Interfaces Module Level 1</h1>
<pre class='metadata'>
Shortname: geometry
Level: 1
Status: ED
ED: http://dev.w3.org/fxtf/geometry/
Group: fxtf
Editor: Simon Pieters, Opera Software ASA, simonp@opera.com
Editor: Dirk Schulze, Adobe Systems Inc., dschulze@adobe.com
Editor: Rik Cabanier, Adobe Systems Inc., rcabanier@adobe.com
Abstract: This specification provides basic geometric interfaces.
</pre>

<h2 id='intro'>Introduction</h2>

This specification describes several geometry interfaces for the representation of points, quads, rectangles and transformation matrices with the dimension of 3x2 and 4x4.

The SVG interfaces SVGPoint, SVGRect and SVGMatrix [[SVG11]] are aliasing the here defined interfaces in favor for common interfaces used by SVG, Canvas 2D Context <!--[[CANVAS-2D]]--> and CSS Transforms [[CSS3-TRANSFORMS]]<!-- and WebGL [[WEBGL]] -->.

<h2 id='terminology'>Terminology</h2>

<dl>
  <dt><dfn>post-multiply</dfn></dt>
  <dd>
    Term A post-multiplied by term B is equal to A &middot; B.
  </dd>
  <dt><dfn>pre-multiply</dfn></dt>
  <dd>
    Term A pre-multiplied by term B is equal to B &middot; A.
  </dd>
  <dt><dfn>multiply</dfn></dt>
  <dd>
    Multiply term A by term B is equal to A &middot; B.
  </dd>
</dl>

<h2 id='DOMPoint'>
The DOMPoint interfaces</h2>

A 2D point or a 3D point can be represented by the following WebIDL interfaces:

<pre class='idl'>
interface DOMPointRead {
    readonly attribute unrestricted double x;
    readonly attribute unrestricted double y;
    readonly attribute unrestricted double z;
    readonly attribute unrestricted double w;
};

[Constructor,
 Constructor(DOMPointDictionary point),
 Constructor(unrestricted double x, unrestricted double y,
             optional unrestricted double z = 0, optional unrestricted double w = 1)]
interface DOMPoint : DOMPointRead {
    inherit attribute unrestricted double x;
    inherit attribute unrestricted double y;
    inherit attribute unrestricted double z;
    inherit attribute unrestricted double w;
};

dictionary DOMPointDictionary {
    unrestricted double x = 0;
    unrestricted double y = 0;
    unrestricted double z = 0;
    unrestricted double w = 1;
};
</pre>

<dl dfn-type=attribute dfn-for='DOMPointRead DOMPoint DOMPointDictionary'>
  <dt><dfn>x</dfn>, of type double</dt>
  <dd>
    The <code>x</code> attribute gives the x coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.
  </dd>
  <dt><dfn>y</dfn>, of type double</dt>
  <dd>
    The <code>y</code> attribute gives the y coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.
  </dd>
  <dt><dfn>z</dfn>, of type double</dt>
  <dd>
    The <code>z</code> attribute gives the z coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.
  </dd>
  <dt><dfn>w</dfn>, of type double</dt>
  <dd>
    The <code>w</code> attribute gives the perspective of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.
  </dd>
</dl>

<p class="issue">SVGPoint has a method: SVGPoint matrixTransform(in SVGMatrix matrix);<br>Should it be adapted and added here as well?</p>

<p class='issue'>SVG defines SVGPointList. Should we modify SVGPointList or create two new interfaces DOMPointList and DOMPointListRead?</p>

<h2 id='DOMRect'>
The DOMRect interfaces</h2>

Objects implementing the <a interface>DOMRectRead</a> interface represent a rectangle. The type of box is specified by the method or attribute that returns a <a interface>DOMRect</a> or <a interface>DOMRectRead</a> object.

Rectangles have the following properties:

<dl>
  <dt><dfn>origin</dfn></dt>
  <dd>
    When the rectangle has a non-negative width, the rectangle's horizontal origin is the left edge; otherwise, it is the right edge. Similarly, when the rectangle has a non-negative height, the rectangle's vertical origin is the top edge; otherwise, it is the bottom edge.
  </dd>
  <dt><dfn>x coordinate</dfn></dt>
  <dd>
    The horizontal distance between the viewport's left edge and the rectangle's origin.
  </dd>
  <dt><dfn>y coordinate</dfn></dt>
  <dd>
    The vertical distance between the viewport's top edge and the rectangle's origin.
  </dd>
  <dt><dfn>width</dfn></dt>
  <dd>
    The width of the rectangle. Can be negative.
  </dd>
  <dt><dfn>height</dfn></dt>
  <dd>
    The height of the rectangle. Can be negative.
  </dd>
</dl>

<pre class='idl'>
typedef (DOMRect or DOMRectRead) DOMRectAny;

[Constructor,
 Constructor(unrestricted double x, unrestricted double y,
             unrestricted double width, unrestricted double height)]
interface DOMRect : DOMRectRead {
    inherit attribute unrestricted double x;
    inherit attribute unrestricted double y;
    inherit attribute unrestricted double width;
    inherit attribute unrestricted double height;
};

interface DOMRectRead {
    readonly attribute unrestricted double x;
    readonly attribute unrestricted double y;
    readonly attribute unrestricted double width;
    readonly attribute unrestricted double height;
    readonly attribute unrestricted double top;
    readonly attribute unrestricted double right;
    readonly attribute unrestricted double bottom;
    readonly attribute unrestricted double left;
};
</pre>

<dl dfn-type=attribute dfn-for='DOMRectRead DOMRect'>
  <dt><dfn>x</dfn>, of type double</dt>
  <dd>
    The <code>x</code> attribute, on getting, must return the <a>x coordinate</a>. The <code>x</code> attribute, on setting, must set the <a>x coordinate</a> to the new value.
  </dd>
  <dt><dfn>y</dfn>, of type double</dt>
  <dd>
    The <code>y</code> attribute, on getting, it must return the <a>y coordinate</a>. The <code>y</code> attribute, on setting, must set the <a>y coordinate</a> to the new value.

  </dd>
  <dt><dfn>height</dfn>, of type double</dt>
  <dd>
    The <code>width</code> attribute, on getting, must return the <a>width</a>. The <code>width</code> attribute, on setting, must set the <a>width</a> to the new value.
  </dd>
  <dt><dfn>width</dfn>, of type double</dt>
  <dd>
    The <code>height</code> attribute, on getting, must return the <a>height</a>. The <code>height</code> attribute, on setting, must set the <a>height</a> to the new value.
  </dd>
  <dt><dfn>top</dfn>, of type double</dt>
  <dd>
    The <code>top</code> attribute, on getting, must return min(<a>y coordinate</a>, <a>y coordinate</a> + <a>height</a>).
  </dd>
  <dt><dfn>right</dfn>, of type double</dt>
  <dd>
    The <code>right</code> attribute, on getting, must return max(<a>x coordinate</a>, <a>x coordinate</a> + <a>width</a>).
  </dd>
  <dt><dfn>bottom</dfn>, of type double</dt>
  <dd>
    The <code>bottom</code> attribute, on getting, must return max(<a>y coordinate</a>, <a>y coordinate</a> + <a>height</a>).
  </dd>
  <dt><dfn>left</dfn>, of type double</dt>
  <dd>
    The <code>left</code> attribute, on getting, must return min(<a>x coordinate</a>, <a>x coordinate</a> + <a>width</a>).
  </dd>
</dl>

<h2 id='DOMQuad'>
The DOMQuad interface</h2>

Objects implementing the <a interface>DOMQuad</a> interface represents a quadrilateral shape. <a interface>DOMQuad</a> objects have an <dfn>associated bounding rectangle</dfn> set to a <a interface>DOMRectRead</a> object when created.

<pre class='idl'>
[Constructor(DOMPointDictionary p1, DOMPointDictionary p2,
             DOMPointDictionary p3, DOMPointDictionary p4),
 Constructor(DOMRectRead rect)]
interface DOMQuad {
    [SameObject] readonly attribute DOMPoint p1;
    [SameObject] readonly attribute DOMPoint p2;
    [SameObject] readonly attribute DOMPoint p3;
    [SameObject] readonly attribute DOMPoint p4;
    [SameObject] readonly attribute DOMRectRead bounds;
};
</pre>

<dl dfn-type=attribute dfn-for=DOMQuad>
  <dt><dfn>p1</dfn>, of type <a interface>DOMPoint</a></dt>
  <dd>
    The <code>p1</code> attribute must return the <a interface>DOMPoint</a> it was set to.
  </dd>
  <dt><dfn>p2</dfn>, of type <a interface>DOMPoint</a></dt>
  <dd>
    The <code>p2</code> attribute must return the <a interface>DOMPoint</a> it was set to.
  </dd>
  <dt><dfn>p3</dfn>, of type <a interface>DOMPoint</a></dt>
  <dd>
    The <code>p3</code> attribute must return the <a interface>DOMPoint</a> it was set to.
  </dd>
  <dt><dfn>p4</dfn>, of type <a interface>DOMPoint</a></dt>
  <dd>
    The <code>p4</code> attribute must return the <a interface>DOMPoint</a> it was set to.
  </dd>
  <dt><dfn>bounds</dfn>, of type <a interface>DOMRectRead</a></dt>
  <dd>
    The bounds attribute must return the <a>associated bounding rectangle</a>.
  </dd>
</dl>

The <a>associated bounding rectangle</a> is live; whenever the objects in <a attribute>p1</a>, <a attribute>p2</a>, <a attribute>p3</a> or <a attribute>p4</a> are changed, the <a>associated bounding rectangle</a> must update its attributes as appropriate to describe the new smallest bounding box of the four points.

<h2 id='DOMMatrix'>
The DOMMatrix interfaces</h2>

The <a interface>DOMMatrix</a> interface represents a mathematical matrix with the purpose of describing transformations a graphical contexts. The following sections describe the details of the interface.

<a interface>DOMMatrix</a> aims to replace the SVGMatrix interface from SVG [[SVG11]]. However, the SVGMatrix interface is mandatory for user agents with support for SVG. The SVGMatrix interface must be an alias to the <a interface>DOMMatrix</a> interface, the same way as the HTMLDocument interface is to the <a interface>Document</a> interface.

<div class="figure">
  <img src="images/4x4matrix.png" alt="4x4 matrix with items m11 to m44">
  <p class="capture">A 4x4 matrix representing a <a interface>DOMMatrix</a> with items m11 to m44.</p>
</div>

<p class='issue'>It needs to be decided if DOMMatrix stored single or double precision floating point numbers.</p>

<pre class='idl'>
typedef (DOMMatrix or DOMMatrixRead) DOMMatrixAny;

interface DOMMatrixRead {
    // These attributes are simple aliases for certain elements of the 4x4 matrix
    readonly attribute unrestricted double a;
    readonly attribute unrestricted double b;
    readonly attribute unrestricted double c;
    readonly attribute unrestricted double d;
    readonly attribute unrestricted double e;
    readonly attribute unrestricted double f;

    readonly attribute unrestricted double m11;
    readonly attribute unrestricted double m12;
    readonly attribute unrestricted double m13;
    readonly attribute unrestricted double m14;
    readonly attribute unrestricted double m21;
    readonly attribute unrestricted double m22;
    readonly attribute unrestricted double m23;
    readonly attribute unrestricted double m24;
    readonly attribute unrestricted double m31;
    readonly attribute unrestricted double m32;
    readonly attribute unrestricted double m33;
    readonly attribute unrestricted double m34;
    readonly attribute unrestricted double m41;
    readonly attribute unrestricted double m42;
    readonly attribute unrestricted double m43;
    readonly attribute unrestricted double m44;

    // Immutable transform methods
    DOMMatrix translate(unrestricted double tx,
                        unrestricted double ty,
                        optional unrestricted double tz = 0);
    DOMMatrix scale(unrestricted double scale,
                    optional unrestricted double originX = 0,
                    optional unrestricted double originY = 0);
    DOMMatrix scale3d(unrestricted double scale,
                      optional unrestricted double originX = 0,
                      optional unrestricted double originY = 0,
                      optional unrestricted double originZ = 0);
    DOMMatrix scaleNonUniform(unrestricted double scaleX,
                              optional unrestricted double scaleY = 1,
                              optional unrestricted double scaleZ = 1,
                              optional unrestricted double originX = 0,
                              optional unrestricted double originY = 0,
                              optional unrestricted double originZ = 0);
    DOMMatrix rotate(unrestricted double angle,
                     optional unrestricted double originX = 0,
                     optional unrestricted double originY = 0);
    DOMMatrix rotateFromVector(unrestricted double x,
                               unrestricted double y);
    DOMMatrix rotateAxisAngle(unrestricted double x,
                              unrestricted double y,
                              unrestricted double z,
                              unrestricted double angle);
    DOMMatrix skewX(unrestricted double sx);
    DOMMatrix skewY(unrestricted double sy);
    DOMMatrix multiply(DOMMatrix other);
    DOMMatrix flipX();
    DOMMatrix flipY();
    DOMMatrix inverse();

    // Helper methods
    boolean             is2D();
    unrestricted double determinant();
    DOMPoint            transformPoint(DOMPointDictionary point);
    Float32Array        toFloat32Array();
    Float64Array        toFloat64Array();
                        stringifier;
};

[Constructor,
 Constructor(DOMString transformList),
 Constructor(DOMMatrixAny other),
 Constructor(Float32array array32),
 Constructor(Float64array array64),
 Constructor(sequence<unrestricted double> numberSequence)]
interface DOMMatrix : DOMMatrixRead {
    // These attributes are simple aliases for certain elements of the 4x4 matrix
    inherit attribute unrestricted double a;
    inherit attribute unrestricted double b;
    inherit attribute unrestricted double c;
    inherit attribute unrestricted double d;
    inherit attribute unrestricted double e;
    inherit attribute unrestricted double f;

    inherit attribute unrestricted double m11;
    inherit attribute unrestricted double m12;
    inherit attribute unrestricted double m13;
    inherit attribute unrestricted double m14;
    inherit attribute unrestricted double m21;
    inherit attribute unrestricted double m22;
    inherit attribute unrestricted double m23;
    inherit attribute unrestricted double m24;
    inherit attribute unrestricted double m31;
    inherit attribute unrestricted double m32;
    inherit attribute unrestricted double m33;
    inherit attribute unrestricted double m34;
    inherit attribute unrestricted double m41;
    inherit attribute unrestricted double m42;
    inherit attribute unrestricted double m43;
    inherit attribute unrestricted double m44;

    // Mutable transform methods
    void multiplyBy(DOMMatrix other);
    void preMultiplyBy(DOMMatrix other);
    void translateBy(unrestricted double tx,
                     unrestricted double ty,
                     optional unrestricted double tz = 0);
    void scaleBy(unrestricted double scale,
                 optional unrestricted double originX = 0,
                 optional unrestricted double originY = 0);
    void scale3dBy(unrestricted double scale,
                   optional unrestricted double originX = 0,
                   optional unrestricted double originY = 0,
                   optional unrestricted double originZ = 0);
    void scaleNonUniformBy(unrestricted double scaleX,
                           optional unrestricted double scaleY = 1,
                           optional unrestricted double scaleZ = 1,
                           optional unrestricted double originX = 0,
                           optional unrestricted double originY = 0,
                           optional unrestricted double originZ = 0);
    void rotateBy(unrestricted double angle,
                  optional unrestricted double originX = 0,
                  optional unrestricted double originY = 0);
    void rotateFromVectorBy(unrestricted double x,
                            unrestricted double y);
    void rotateAxisAngleBy(unrestricted double x,
                           unrestricted double y,
                           unrestricted double z,
                           unrestricted double angle);
    void skewXBy(unrestricted double sx);
    void skewYBy(unrestricted double sy);
    void invert();
}
</pre>