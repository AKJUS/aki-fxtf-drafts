<h1>Geometry Interfaces Module Level 1</h1>
<!-- To the extent possible under law, the editors have waived all copyright and related or neighboring rights to this work. -->
<pre class='metadata'>
Shortname: geometry
Level: 1
Status: ED
ED: http://dev.w3.org/fxtf/geometry/
Group: fxtf
Editor: Simon Pieters, Opera Software ASA, simonp@opera.com
Editor: Dirk Schulze, Adobe Systems Inc., dschulze@adobe.com
Editor: Rik Cabanier, Adobe Systems Inc., rcabanier@adobe.com
Abstract: This specification provides basic geometric interfaces.
!Issues list: <a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=FXTF&amp;component=Geometry&amp;resolution=---">Bugzilla</a> (<a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=FXTF&amp;component=Geometry">file a bug</a>)
</pre>

<script src=https://w3c-test.org/resources.whatwg.org/file-bug.js async></script>

<h2 id='intro'>Introduction</h2>

This specification describes several geometry interfaces for the representation of points, quads, rectangles and transformation matrices with the dimension of 3x2 and 4x4.

The SVG interfaces SVGPoint, SVGRect and SVGMatrix [[SVG11]] are aliasing the here defined interfaces in favor for common interfaces used by SVG, Canvas 2D Context <!--[[CANVAS-2D]]--> and CSS Transforms [[CSS3-TRANSFORMS]]<!-- and WebGL [[WEBGL]] -->.

<h2 id='terminology'>Terminology</h2>

<dl>
  <dt><dfn>post-multiply</dfn></dt>
  <dd>
    Term A post-multiplied by term B is equal to A &middot; B.
  </dd>
  <dt><dfn>pre-multiply</dfn></dt>
  <dd>
    Term A pre-multiplied by term B is equal to B &middot; A.
  </dd>
  <dt><dfn>multiply</dfn></dt>
  <dd>
    Multiply term A by term B is equal to A &middot; B.
  </dd>
</dl>

<h2 id='DOMPoint'>
The DOMPoint interfaces</h2>

A 2D point or a 3D point can be represented by the following WebIDL interfaces:

<pre class='idl'>
interface DOMPointReadOnly {
    readonly attribute unrestricted double x;
    readonly attribute unrestricted double y;
    readonly attribute unrestricted double z;
    readonly attribute unrestricted double w;
};

[Constructor,
 Constructor(DOMPointInit point),
 Constructor(unrestricted double x, unrestricted double y,
             optional unrestricted double z = 0, optional unrestricted double w = 1)]
interface DOMPoint : DOMPointReadOnly {
    inherit attribute unrestricted double x;
    inherit attribute unrestricted double y;
    inherit attribute unrestricted double z;
    inherit attribute unrestricted double w;
};

dictionary DOMPointInit {
    unrestricted double x = 0;
    unrestricted double y = 0;
    unrestricted double z = 0;
    unrestricted double w = 1;
};
</pre>

<p>The <dfn dfn-type=constructor dfn-for=DOMPoint><code>DOMPoint()</code></dfn> constructor, when invoked, must run the following steps:

<ol>
 <li><p>If invoked with one argument, follow these substeps:
  <ol>
   <li><p>Let <var>point</var> be the argument.
   <li><p>Let <var>x</var> be the <code>x</code> dictionary member of <var>point</var>.
   <li><p>Let <var>y</var> be the <code>y</code> dictionary member of <var>point</var>.
   <li><p>Let <var>z</var> be the <code>z</code> dictionary member of <var>point</var>.
   <li><p>Let <var>w</var> be the <code>w</code> dictionary member of <var>point</var>.
  </ol>
 <li><p>Otherwise, let <var>x</var>, <var>y</var>, <var>z</var> and <var>w</var> be the given arguments, respectively.
 <li><p>Return a new <code>DOMPoint</code> object with the <code title=dom-DOMPoint-x>x</code>, <code title=dom-DOMPoint-y>y</code>,
 <code title=dom-DOMPoint-z>z</code> and <code title=dom-DOMPoint-w>w</code> attributes set to <var>x</var>, <var>y</var>, <var>z</var> and <var>w</var>,
 respectively.
</ol>


<div dfn-type=attribute dfn-for='DOMPointReadOnly DOMPoint'>
 The <dfn>x</dfn> attribute gives the x coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.

 The <dfn>y</dfn> attribute gives the y coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.

 The <dfn>z</dfn> attribute gives the z coordinate of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.

 The <dfn>w</dfn> attribute gives the perspective of the point. On getting, it must return the current value. On setting, it must set the current value to the new value.
</div>

<p class="issue">SVGPoint has a method: SVGPoint matrixTransform(in SVGMatrix matrix);<br>Should it be adapted and added here as well?</p>

<p class='issue'>SVG defines SVGPointList. Should we modify SVGPointList or create two new interfaces DOMPointList and DOMPointListReadOnly?</p>

<h2 id='DOMRect'>
The DOMRect interfaces</h2>

Objects implementing the <a interface>DOMRectReadOnly</a> interface represent a <dfn>rectangle</dfn>. The type of box is specified by the method or attribute that returns a <a interface>DOMRect</a> or <a interface>DOMRectReadOnly</a> object.

Rectangles have the following properties:

<dl dfn-for=rectangle>
  <dt><dfn>origin</dfn></dt>
  <dd>
    When the rectangle has a non-negative <a>width</a>, the rectangle's horizontal origin is the left edge; otherwise, it is the right edge. Similarly, when the rectangle has a non-negative <a>height</a>, the rectangle's vertical origin is the top edge; otherwise, it is the bottom edge.
  </dd>
  <dt><dfn>x coordinate</dfn></dt>
  <dd>
    The horizontal distance between the viewport's left edge and the rectangle's <a>origin</a>.
  </dd>
  <dt><dfn>y coordinate</dfn></dt>
  <dd>
    The vertical distance between the viewport's top edge and the rectangle's <a>origin</a>.
  </dd>
  <dt><dfn>width</dfn></dt>
  <dd>
    The width of the rectangle. Can be negative.
  </dd>
  <dt><dfn>height</dfn></dt>
  <dd>
    The height of the rectangle. Can be negative.
  </dd>
</dl>

<pre class='idl'>
[Constructor,
 Constructor(unrestricted double x, unrestricted double y,
             unrestricted double width, unrestricted double height)]
interface DOMRect : DOMRectReadOnly {
    inherit attribute unrestricted double x;
    inherit attribute unrestricted double y;
    inherit attribute unrestricted double width;
    inherit attribute unrestricted double height;
};

interface DOMRectReadOnly {
    readonly attribute unrestricted double x;
    readonly attribute unrestricted double y;
    readonly attribute unrestricted double width;
    readonly attribute unrestricted double height;
    readonly attribute unrestricted double top;
    readonly attribute unrestricted double right;
    readonly attribute unrestricted double bottom;
    readonly attribute unrestricted double left;
};
</pre>

<p>The <dfn dfn-type=constructor dfn-for=DOMRect><code>DOMRect(<var>x</var>, <var>y</var>, <var>width</var>, <var>height</var>)</code></dfn> constructor, when
invoked, must run the following steps:

<ol>
 <li><p>If invoked with no arguments, let <var>x</var>, <var>y</var>, <var>width</var> and <var>height</var> be zero.
 <li><p>Return a new <code>DOMRect</code> object with <a>x coordinate</a> set to <var>x</var>,
 <a>y coordinate</a> set to <var>y</var>, <a>width</a> set to
 <var>width</var> and <a>height</a> set to <var>height</var>.
</ol>


<div dfn-type=attribute dfn-for='DOMRectReadOnly DOMRect'>
 The <dfn>x</dfn> attribute, on getting, must return the <a>x coordinate</a>. The <a attribute for=DOMRect>x</a> attribute, on setting, must set the <a>x coordinate</a> to the new value.

 The <dfn>y</dfn> attribute, on getting, it must return the <a>y coordinate</a>. The <a attribute for=DOMRect>y</a> attribute, on setting, must set the <a>y coordinate</a> to the new value.

 The <dfn>width</dfn> attribute, on getting, must return the <a>width</a>. The <a attribute for=DOMRect>width</a> attribute, on setting, must set the <a>width</a> to the new value.

 The <dfn>height</dfn> attribute, on getting, must return the <a>height</a>. The <a attribute for=DOMRect>height</a> attribute, on setting, must set the <a>height</a> to the new value.

 The <dfn>top</dfn> attribute, on getting, must return min(<a>y coordinate</a>, <a>y coordinate</a> + <a>height</a>).

 The <dfn>right</dfn> attribute, on getting, must return max(<a>x coordinate</a>, <a>x coordinate</a> + <a>width</a>).

 The <dfn>bottom</dfn> attribute, on getting, must return max(<a>y coordinate</a>, <a>y coordinate</a> + <a>height</a>).

 The <dfn>left</dfn> attribute, on getting, must return min(<a>x coordinate</a>, <a>x coordinate</a> + <a>width</a>).
</div>

<h2 id='DOMRectList'>
The DOMRectList Interface</h2>

<pre class='idl'>
[ArrayClass]
interface DOMRectList {
    readonly attribute unsigned long length;
    getter DOMRect item(unsigned long index);
};
</pre>

The <dfn dfn-type=attribute dfn-for='DOMRectList'>length</dfn> attribute must return the total number of <a interface>DOMRect</a> objects associated with the object.

The <dfn dfn-type=method dfn-for='DOMRectList'>item(<var>index</var>)</dfn> method, when invoked, must throw an <a exception>IndexSizeError</a> exception when <var>index</var> is greater than the number of <a interface>DOMRect</a> objects associated with the object. Otherwise, the <a interface>DOMRect</a> object at <var>index</var> must be returned.

<h2 id='DOMQuad'>
The DOMQuad interface</h2>

Objects implementing the <a interface>DOMQuad</a> interface represents a <dfn>quadrilateral</dfn>. <a interface>DOMQuad</a> objects have an <dfn for=quadlirateral>associated bounding rectangle</dfn> set to a <a interface>DOMRectReadOnly</a> object when created.

<pre class='idl'>
[Constructor(DOMPointInit p1, DOMPointInit p2,
             DOMPointInit p3, DOMPointInit p4),
 Constructor(DOMRectReadOnly rect)]
interface DOMQuad {
    [SameObject] readonly attribute DOMPoint p1;
    [SameObject] readonly attribute DOMPoint p2;
    [SameObject] readonly attribute DOMPoint p3;
    [SameObject] readonly attribute DOMPoint p4;
    [SameObject] readonly attribute DOMRectReadOnly bounds;
};
</pre>

<p>The <dfn dfn-type=constructor dfn-for=DOMQuad><code>DOMQuad()</code></dfn> constructor, when invoked, must run the following steps:

<ol>
 <li><p>If invoked with one argument, follow these substeps:
  <ol>
   <li><p>Let <var>rect</var> be the argument.
   <li><p>Let <var>x</var>, <var>y</var>, <var>width</var> and <var>height</var> be <var>rect</var>'s the value of <code title=dom-DOMRect-x>x</code>,
   <code title=dom-DOMRect-y>y</code>, <code title=dom-DOMRect-width>width</code> and <code title=dom-DOMRect-height>height</code> attributes,
   respectively.
   <li><p>Let <var>point 1</var> be a new <code>DOMPoint</code> object with <code title=dom-DOMPoint-x>x</code> set to <var>x</var>,
   <code title=dom-DOMPoint-y>y</code> set to <var>y</var>, <code title=dom-DOMPoint-z>z</code> set to zero and <code title=dom-DOMPoint-w>w</code> set to
   one.
   <li><p>Let <var>point 2</var> be a new <code>DOMPoint</code> object with <code title=dom-DOMPoint-x>x</code> set to <var>x</var> + <var>width</var>,
   <code title=dom-DOMPoint-y>y</code> set to <var>y</var>, <code title=dom-DOMPoint-z>z</code> set to zero and <code title=dom-DOMPoint-w>w</code> set to
   one.
   <li><p>Let <var>point 3</var> be a new <code>DOMPoint</code> object with <code title=dom-DOMPoint-x>x</code> set to <var>x</var> + <var>width</var>,
   <code title=dom-DOMPoint-y>y</code> set to <var>y</var> + <var>height</var>, <code title=dom-DOMPoint-z>z</code> set to zero and
   <code title=dom-DOMPoint-w>w</code> set to one.
   <li><p>Let <var>point 4</var> be a new <code>DOMPoint</code> object with <code title=dom-DOMPoint-x>x</code> set to <var>x</var>,
   <code title=dom-DOMPoint-y>y</code> set to <var>y</var> + <var>height</var>, <code title=dom-DOMPoint-z>z</code> set to zero and
   <code title=dom-DOMPoint-w>w</code> set to one.
   <li><p>Let <var>bounds</var> be a new <code>DOMRectReadOnly</code> object with its attributes set to the values of the namesake attributes in
   <var>rect</var>.
  </ol>
 <li><p>Otherwise, follow these substeps:
  <ol>
   <li><p>Let <var>p1</var>, <var>p2</var>, <var>p3</var> and <var>p4</var> be the given arguments, in the same order.
   <li><p>Let <var>point 1</var> be a new <code>DOMPoint</code> object with its attributes set to the values of the namesake dictionary members in
   <var>p1</var>.
   <li><p>Let <var>point 2</var> be a new <code>DOMPoint</code> object with its attributes set to the values of the namesake dictionary members in
   <var>p2</var>.
   <li><p>Let <var>point 3</var> be a new <code>DOMPoint</code> object with its attributes set to the values of the namesake dictionary members in
   <var>p3</var>.
   <li><p>Let <var>point 4</var> be a new <code>DOMPoint</code> object with its attributes set to the values of the namesake dictionary members in
   <var>p4</var>.
   <li><p>Let <var>bounds</var> be a new <code>DOMRectReadOnly</code> object describing the smallest bounding box of <var>point 1</var>, <var>point 2</var>,
   <var>point 3</var> and <var>point 4</var>.
  </ol>
 <li><p>Return a new <code>DOMQuad</code> with <code title=dom-DOMQuad-p1>p1</code> set to <var>point 1</var>, <code title=dom-DOMQuad-p2>p2</code> set to
 <var>point 2</var>, <code title=dom-DOMQuad-p3>p3</code> set to <var>point 3</var> and <code title=dom-DOMQuad-p4>p4</code> set to <var>point 4</var>, and
 let the <a>associated bounding rectangle</a> be <var>bounds</var>.
</ol>

<div dfn-type=attribute dfn-for=DOMQuad>
 The <dfn>p1</dfn> attribute must return the <a interface>DOMPoint</a> it was set to.

 The <dfn>p2</dfn> attribute must return the <a interface>DOMPoint</a> it was set to.

 The <dfn>p3</dfn> attribute must return the <a interface>DOMPoint</a> it was set to.

 The <dfn>p4</dfn> attribute must return the <a interface>DOMPoint</a> it was set to.

 The <dfn>bounds</dfn> attribute must return the <a>associated bounding rectangle</a>.
</div>

The <a>associated bounding rectangle</a> is live; whenever the objects in <a attribute>p1</a>, <a attribute>p2</a>, <a attribute>p3</a> or <a attribute>p4</a> are changed, the <a>associated bounding rectangle</a> must update its attributes as appropriate to describe the new smallest bounding box of the four points.

<h2 id='DOMMatrix'>
The DOMMatrix interfaces</h2>

The <a interface>DOMMatrix</a> interface represents a mathematical matrix with the purpose of describing transformations a graphical contexts. The following sections describe the details of the interface.

<a interface>DOMMatrix</a> aims to replace the SVGMatrix interface from SVG [[SVG11]].

For historical reasons, if the user agent supports SVG, <a interface>Window</a> objects must have a writable, configurable, non-enumerable property named <dfn>SVGMatrix</dfn> whose value is the <a interface>DOMMatrix</a> interface object. [[SVG11]]

<div class="figure">
  <img src="images/4x4matrix.png" alt="4x4 matrix with items m11 to m44">
  <p class="capture">A 4x4 matrix representing a <a interface>DOMMatrix</a> with items m11 to m44.</p>
</div>

<p class='issue'>It needs to be decided if DOMMatrix stored single or double precision floating point numbers.</p>

<pre class='idl'>
typedef (DOMMatrix or DOMMatrixReadOnly) DOMMatrixAny;

interface DOMMatrixReadOnly {
    // These attributes are simple aliases for certain elements of the 4x4 matrix
    readonly attribute unrestricted double a;
    readonly attribute unrestricted double b;
    readonly attribute unrestricted double c;
    readonly attribute unrestricted double d;
    readonly attribute unrestricted double e;
    readonly attribute unrestricted double f;

    readonly attribute unrestricted double m11;
    readonly attribute unrestricted double m12;
    readonly attribute unrestricted double m13;
    readonly attribute unrestricted double m14;
    readonly attribute unrestricted double m21;
    readonly attribute unrestricted double m22;
    readonly attribute unrestricted double m23;
    readonly attribute unrestricted double m24;
    readonly attribute unrestricted double m31;
    readonly attribute unrestricted double m32;
    readonly attribute unrestricted double m33;
    readonly attribute unrestricted double m34;
    readonly attribute unrestricted double m41;
    readonly attribute unrestricted double m42;
    readonly attribute unrestricted double m43;
    readonly attribute unrestricted double m44;

    // Immutable transform methods
    DOMMatrix translate(unrestricted double tx,
                        unrestricted double ty,
                        optional unrestricted double tz = 0);
    DOMMatrix scale(unrestricted double scale,
                    optional unrestricted double originX = 0,
                    optional unrestricted double originY = 0);
    DOMMatrix scale3d(unrestricted double scale,
                      optional unrestricted double originX = 0,
                      optional unrestricted double originY = 0,
                      optional unrestricted double originZ = 0);
    DOMMatrix scaleNonUniform(unrestricted double scaleX,
                              optional unrestricted double scaleY = 1,
                              optional unrestricted double scaleZ = 1,
                              optional unrestricted double originX = 0,
                              optional unrestricted double originY = 0,
                              optional unrestricted double originZ = 0);
    DOMMatrix rotate(unrestricted double angle,
                     optional unrestricted double originX = 0,
                     optional unrestricted double originY = 0);
    DOMMatrix rotateFromVector(unrestricted double x,
                               unrestricted double y);
    DOMMatrix rotateAxisAngle(unrestricted double x,
                              unrestricted double y,
                              unrestricted double z,
                              unrestricted double angle);
    DOMMatrix skewX(unrestricted double sx);
    DOMMatrix skewY(unrestricted double sy);
    DOMMatrix multiply(DOMMatrix other);
    DOMMatrix flipX();
    DOMMatrix flipY();
    DOMMatrix inverse();

    // Helper methods
    boolean             is2D();
    unrestricted double determinant();
    DOMPoint            transformPoint(DOMPointInit point);
    Float32Array        toFloat32Array();
    Float64Array        toFloat64Array();
                        stringifier;
};

[Constructor,
 Constructor(DOMString transformList),
 Constructor(DOMMatrixAny other),
 Constructor(Float32Array array32),
 Constructor(Float64Array array64),
 Constructor(sequence&lt;unrestricted double> numberSequence)]
interface DOMMatrix : DOMMatrixReadOnly {
    // These attributes are simple aliases for certain elements of the 4x4 matrix
    inherit attribute unrestricted double a;
    inherit attribute unrestricted double b;
    inherit attribute unrestricted double c;
    inherit attribute unrestricted double d;
    inherit attribute unrestricted double e;
    inherit attribute unrestricted double f;

    inherit attribute unrestricted double m11;
    inherit attribute unrestricted double m12;
    inherit attribute unrestricted double m13;
    inherit attribute unrestricted double m14;
    inherit attribute unrestricted double m21;
    inherit attribute unrestricted double m22;
    inherit attribute unrestricted double m23;
    inherit attribute unrestricted double m24;
    inherit attribute unrestricted double m31;
    inherit attribute unrestricted double m32;
    inherit attribute unrestricted double m33;
    inherit attribute unrestricted double m34;
    inherit attribute unrestricted double m41;
    inherit attribute unrestricted double m42;
    inherit attribute unrestricted double m43;
    inherit attribute unrestricted double m44;

    // Mutable transform methods
    void multiplyBy(DOMMatrix other);
    void preMultiplyBy(DOMMatrix other);
    void translateBy(unrestricted double tx,
                     unrestricted double ty,
                     optional unrestricted double tz = 0);
    void scaleBy(unrestricted double scale,
                 optional unrestricted double originX = 0,
                 optional unrestricted double originY = 0);
    void scale3dBy(unrestricted double scale,
                   optional unrestricted double originX = 0,
                   optional unrestricted double originY = 0,
                   optional unrestricted double originZ = 0);
    void scaleNonUniformBy(unrestricted double scaleX,
                           optional unrestricted double scaleY = 1,
                           optional unrestricted double scaleZ = 1,
                           optional unrestricted double originX = 0,
                           optional unrestricted double originY = 0,
                           optional unrestricted double originZ = 0);
    void rotateBy(unrestricted double angle,
                  optional unrestricted double originX = 0,
                  optional unrestricted double originY = 0);
    void rotateFromVectorBy(unrestricted double x,
                            unrestricted double y);
    void rotateAxisAngleBy(unrestricted double x,
                           unrestricted double y,
                           unrestricted double z,
                           unrestricted double angle);
    void skewXBy(unrestricted double sx);
    void skewYBy(unrestricted double sy);
    void invert();
};
</pre>
